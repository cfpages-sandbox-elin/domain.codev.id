# Domain Codev

An aesthetically pleasing app to check domain availability and track domain expiration dates. It helps you renew your domains on time or snatch up expiring ones as soon as they drop, with all your data securely stored in your personal account.

![Domain Codev Screenshot](https://picsum.photos/1200/600)

## Features

*   **Secure User Accounts:** Sign in with your Google account to keep your domain list private and synced.
*   **Secure & Resilient Domain Checks:** Real-time WHOIS lookups are proxied through a secure Supabase Edge Function. This resolves CORS issues and protects API keys by never exposing them to the browser. The backend uses a tiered approach with multiple WHOIS providers for high availability.
*   **Automated Daily Checks:** A secure, server-side Supabase Edge Function (`check-domains`) runs daily to automatically update the status of your tracked domains, checking for expirations and drops.
*   **Bulk Add, Import & Export:** Easily manage large lists of domains by pasting a list or importing/exporting in JSON/CSV format. Bulk additions are processed concurrently with rate-limiting to ensure speed and reliability.
*   **Manual Re-check:** For any domain where the lookup failed, a simple "Re-check" button allows you to instantly try again via the secure backend proxy.
*   **Direct Purchase Links:** For available domains, get quick links to recommended registrars to purchase the domain immediately.
*   **Advanced Expiration Alerts:** Get multi-level, color-coded visual alerts for domains expiring within 90, 30, and 7 days, plus a critical alert for already expired domains.
*   **Track Your Portfolio:** Add domains to a personal tracking list.
*   **Smart Tagging & Keyboard Shortcuts:** Tag domains as "Mine" or "To Snatch". Add them even faster using `Enter` (for Mine) and `Shift+Enter` (for To Snatch).
*   **Advanced Filtering:** Filter your list by tag, status, or urgency, including a dedicated "Available" filter.
*   **Drop-Catching Helper:** For expired domains, get an estimated timeline for when they might become available.
*   **Light/Dark & Compact/Standard Modes:** Beautifully designed interface that's easy on the eyes, with view modes to suit your preference.
*   **Cloud Data Persistence:** Your list is securely saved to your Supabase account, accessible from anywhere.

## Tech Stack

*   **Vite** + **React 18** & **TypeScript**
*   **Tailwind CSS** for styling
*   **Supabase** for Authentication, Database, and Edge Functions
*   **WHOIS Providers (used by Edge Functions):** `who-dat`, WhoisXMLAPI, apilayer.com, whoisfreaks.com, etc.
*   **Cron Job Schedulers**: Supabase Cron or external services (e.g., fastcron.com)

---

## Getting Started: Local Development

Follow these steps to set up and run the project on your local machine.

### Step 1: Clone the Repository

```bash
git clone <repository-url>
cd <repository-directory>
```

### Step 2: Install Dependencies

You need to have [Node.js](https://nodejs.org/) (version 18 or newer) installed.

```bash
npm install
```

### Step 3: Configure Environment Variables

1.  Create a new file named `.env` in the root of the project.
2.  Add the required variables for Supabase. **Note: WHOIS API keys are NOT needed here.** They are managed as secrets in your Supabase project settings.

    ```env
    # Supabase Credentials (Required)
    VITE_SUPABASE_URL=YOUR_SUPABASE_PROJECT_URL
    VITE_SUPABASE_ANON_KEY=YOUR_SUPABASE_ANON_KEY
    ```

    **Note:** The `VITE_` prefix is required for Vite to expose these variables to the application.

### Step 4: Set Up the Database Table

(Instructions for this step are unchanged and can be found in the original `README.md`)
```sql
-- Create custom types for cleaner constraints
CREATE TYPE public.domain_tag_type AS ENUM ('mine', 'to-snatch');
CREATE TYPE public.domain_status_type AS ENUM ('available', 'registered', 'expired', 'dropped', 'unknown');

-- Create the 'domains' table
CREATE TABLE public.domains (
    id bigint NOT NULL GENERATED BY DEFAULT AS IDENTITY,
    user_id uuid NOT NULL DEFAULT auth.uid(),
    domain_name text NOT NULL,
    tag public.domain_tag_type NOT NULL,
    status public.domain_status_type NOT NULL,
    expiration_date timestamptz NULL,
    registered_date timestamptz NULL,
    registrar text NULL,
    created_at timestamptz NOT NULL DEFAULT now(),
    last_checked timestamptz NULL,
    CONSTRAINT domains_pkey PRIMARY KEY (id),
    CONSTRAINT domains_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users (id) ON DELETE CASCADE,
    CONSTRAINT domains_user_id_domain_name_key UNIQUE (user_id, domain_name)
);

-- Add comments to columns for clarity in the Supabase UI
COMMENT ON TABLE public.domains IS 'Stores domains tracked by users.';
COMMENT ON COLUMN public.domains.id IS 'Primary key for the domain entry.';
COMMENT ON COLUMN public.domains.user_id IS 'Foreign key linking to the user who owns this entry.';
COMMENT ON COLUMN public.domains.domain_name IS 'The domain name being tracked.';
COMMENT ON COLUMN public.domains.tag IS 'User-defined tag: "mine" or "to-snatch".';
COMMENT ON COLUMN public.domains.status IS 'Current status of the domain.';
COMMENT ON COLUMN public.domains.expiration_date IS 'The expiration date of the domain.';
COMMENT ON COLUMN public.domains.registered_date IS 'The registration date of the domain.';
COMMENT ON COLUMN public.domains.registrar IS 'The registrar of the domain.';
COMMENT ON COLUMN public.domains.last_checked IS 'Timestamp of the last successful WHOIS check.';
COMMENT ON COLUMN public.domains.created_at IS 'Timestamp when the domain was added to the tracker.';

-- Enable Row Level Security (RLS) for the table
ALTER TABLE public.domains ENABLE ROW LEVEL SECURITY;

-- Create RLS policies
-- 1. Users can see their own domains
CREATE POLICY "Allow users to view their own domains"
ON public.domains
FOR SELECT
USING (auth.uid() = user_id);

-- 2. Users can insert new domains for themselves
CREATE POLICY "Allow users to insert their own domains"
ON public.domains
FOR INSERT
WITH CHECK (auth.uid() = user_id);

-- 3. Users can update their own domains
CREATE POLICY "Allow users to update their own domains"
ON public.domains
FOR UPDATE
USING (auth.uid() = user_id)
WITH CHECK (auth.uid() = user_id);

-- 4. Users can delete their own domains
CREATE POLICY "Allow users to delete their own domains"
ON public.domains
FOR DELETE
USING (auth.uid() = user_id);
```

### Step 5: Run the Development Server

```bash
npm run dev
```

---

## Setting Up Backend Functions

To enable both real-time domain lookups and automatic daily checks, you need to deploy the Supabase Edge Functions. This is a crucial step for the app's core functionality.

Choose one of the following methods based on your comfort level.

---

### Method 1: Using the Supabase Dashboard (Recommended for Beginners)

This method uses the Supabase website interface and is perfect if you are not comfortable with command-line tools.

#### Step 1: Deploy the Edge Functions
You will deploy two functions: `get-whois` (for real-time checks) and `check-domains` (for daily cron jobs).

1.  Go to your project on the [Supabase Dashboard](https://app.supabase.com).
2.  In the left sidebar, click on the **Edge Functions** icon (a lightning bolt).
3.  **For `get-whois`:**
    *   Click **"Create a function"**. Name it `get-whois` and click **"Create function"**.
    *   Delete the boilerplate code and paste in the content from `supabase/functions/get-whois/index.ts`.
    *   Click **"Save and Deploy"**.
4.  **For `check-domains`:**
    *   Click **"Create a function"**. Name it `check-domains` and click **"Create function"**.
    *   Delete the boilerplate code and paste in the content from `supabase/functions/check-domains/index.ts`.
    *   Click **"Save and Deploy"**.

#### Step 2: Set the Required Secrets
The functions need API keys and a cron secret to work. These are stored securely in your project's settings and are never exposed to the public.

1.  **Generate a Cron Secret:**
    *   Use a password generator to create a strong, random string. Copy this value. This key will authorize scheduled jobs to run your function.

2.  **Add Secrets in Supabase:**
    *   In the Supabase Dashboard, go to **Settings** -> **Edge Functions**.
    *   Click **"+ Add new secret"** for each of the following:
        *   `CRON_SECRET`: Paste the secret string you generated.
        *   `WHOIS_API_KEY`: Your key from WhoisXMLAPI.
        *   `APILAYER_API_KEY`: Your key from apilayer.com.
        *   ... and so on for any other WHOIS API keys you have. Add at least one.

    > **Important:** The secret names here **do not** have the `VITE_` prefix.

#### Step 3: Schedule the Cron Job
(Instructions for enabling `pg_cron` and scheduling the `check-domains` function are unchanged. Follow Steps 4 & 5 from the original `README.md`)

---

### Method 2: Using the Supabase CLI (For Developers)

This method is faster if you are familiar with the command line.

#### 1. Install and Link CLI

```bash
# Install the CLI
npm install supabase --save-dev

# Log in and link your project
npx supabase login
npx supabase link --project-ref <your-project-ref>
```

#### 2. Set Secrets for the Edge Functions

Run these commands in your terminal, replacing the placeholders with your actual keys.

```bash
# Required: Secret to authorize the cron job
npx supabase secrets set CRON_SECRET=YOUR_SUPER_SECRET_STRING_HERE

# Required: WHOIS API Keys (add at least one)
npx supabase secrets set WHOIS_API_KEY=YOUR_WHOISXMLAPI_KEY
npx supabase secrets set APILAYER_API_KEY=YOUR_APILAYER_KEY
npx supabase secrets set WHOISFREAKS_API_KEY=YOUR_WHOISFREAKS_KEY
npx supabase secrets set WHOAPI_COM_API_KEY=YOUR_WHOAPI_COM_KEY
npx supabase secrets set RAPIDAPI_KEY=YOUR_RAPIDAPI_KEY

# Optional: Set these if you are using a self-hosted who-dat instance
# npx supabase secrets set WHO_DAT_URL=https://your-who-dat-instance.vercel.app
# npx supabase secrets set WHO_DAT_AUTH_KEY=YOUR_WHO_DAT_SECRET_KEY
```

#### 3. Deploy the Edge Functions

Deploy both the `get-whois` and `check-domains` functions.

```bash
npx supabase functions deploy get-whois
npx supabase functions deploy check-domains
```

After deploying, enable the Cron extension and schedule the job for `check-domains` using the Supabase Dashboard as described in **Steps 4 and 5** of Method 1.

## Production Deployment

For instructions on how to deploy this application and troubleshoot common production issues, see the **[Deployment Guide](./deployment.md)**.
